<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Screen Stream</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white flex flex-col items-center justify-center min-h-screen">

  <h1 class="text-3xl font-bold mb-6">Live Screen Stream</h1>

  <div class="space-x-4 mb-6">
    <button id="startBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
      Start Screen Share
    </button>
    <button id="stopBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
      Stop Screen Share
    </button>
  </div>

  <video id="screenVideo" autoplay playsinline class="w-11/12 max-w-4xl border-4 border-white rounded-lg"></video>

  <script>

    const websocket = new WebSocket("ws://localhost:8091/screen");
    
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const video = document.getElementById('screenVideo');
    const options = { mimeType: 'video/webm;codecs=vp8,opus' };

    let stream = null;
    let mediarecorder;

    startBtn.addEventListener('click',  () => {

        stream =  navigator.mediaDevices.getDisplayMedia({
          video: true,
          audio: true
        }).then(function(Mediastream){
              video.srcObject = Mediastream
              mediarecorder = new MediaRecorder(Mediastream,options)

              mediarecorder.ondataavailable = (e) => {
          if (e.data.size > 0 && websocket.readyState === WebSocket.OPEN) {
            websocket.send(e.data);
            console.log(e.data)
          }
        };

        mediarecorder.start(200); 
      })
   })
 
    stopBtn.addEventListener('click', () => {
          
      mediarecorder.stop();
      alert("Recording stopped.");

    fetch("/stop-stream", {
      method: "POST",
      headers: {
    "Content-Type": "text/plain"
     },
     body: "stopping"
    });
    });
    
  </script>

</body>
</html>
